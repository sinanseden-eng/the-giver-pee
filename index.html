<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PEE Paragraph Analysis - The Giver</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #2d3748;
        }

        html {
            height: 100%;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .main-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.25rem;
            color: #4a5568;
            font-style: italic;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }

        .point-icon {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .evidence-icon {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .explain-icon {
            background: linear-gradient(45deg, #45b7d1, #96c93d);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
        }

        .card-content {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #4a5568;
        }

        .quote {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #f39c12;
            font-style: italic;
            margin: 1rem 0;
            position: relative;
        }

        .quote::before {
            content: '"';
            font-size: 4rem;
            color: #f39c12;
            position: absolute;
            top: -10px;
            left: 10px;
            opacity: 0.3;
        }

        .final-paragraph {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            margin-top: 2rem;
        }

        .final-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .final-content {
            font-size: 1.2rem;
            line-height: 1.8;
            text-align: justify;
        }

        .decorative-element {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .decorative-1 {
            background: #ff6b6b;
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        .decorative-2 {
            background: #4ecdc4;
            top: 60%;
            right: 10%;
            animation-delay: 2s;
        }

        .decorative-3 {
            background: #45b7d1;
            bottom: 20%;
            left: 15%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .exercise-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-top: 3rem;
        }

        .exercise-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .exercise-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .exercise-subtitle {
            font-size: 1.2rem;
            color: #4a5568;
            font-style: italic;
        }

        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .topic-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .topic-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(240, 147, 251, 0.3);
        }

        .topic-card:nth-child(2) {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .topic-card:nth-child(3) {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .topic-card:nth-child(4) {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .topic-number {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2rem;
            font-weight: bold;
            opacity: 0.3;
        }

        .topic-card h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .topic-card p {
            font-size: 1rem;
            line-height: 1.5;
            margin: 0;
        }

        .selected-topic {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
        }

        .writing-exercise {
            margin-top: 1.5rem;
        }

        .pee-step {
            margin-bottom: 1.5rem;
        }

        .pee-step label {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .pee-step textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .pee-step textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .generate-btn, .reset-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 1rem;
        }

        .generate-btn:hover, .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .reset-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            margin-left: 1rem;
        }

        .generated-paragraph {
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
            border: 2px solid #667eea;
        }

        .paragraph-output {
            background: #f7fafc;
            padding: 1.5rem;
            border-radius: 10px;
            font-size: 1.1rem;
            line-height: 1.7;
            color: #2d3748;
            border-left: 4px solid #667eea;
        }

        .ai-feedback-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e2e8f0;
        }

        .ai-feedback {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
            border-left: 4px solid #48bb78;
        }

        .ai-feedback h4 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .feedback-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid #667eea;
        }

        .feedback-item:last-child {
            margin-bottom: 0;
        }

        .feedback-category {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .feedback-text {
            color: #4a5568;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .feedback-score {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .loading-feedback {
            text-align: center;
            padding: 2rem;
            color: #667eea;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .quote-options {
            display: grid;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .quote-option {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .quote-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .quote-option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .quote-option.correct {
            border-color: #48bb78;
            background: rgba(72, 187, 120, 0.1);
        }

        .quote-option.incorrect {
            border-color: #f56565;
            background: rgba(245, 101, 101, 0.1);
        }

        .quote-text {
            font-style: italic;
            color: #2d3748;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .quote-source {
            font-size: 0.9rem;
            color: #718096;
            font-weight: bold;
        }

        .quote-feedback {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 0.9rem;
            display: none;
        }

        .quote-feedback.correct {
            background: rgba(72, 187, 120, 0.1);
            color: #2f855a;
        }

        .quote-feedback.incorrect {
            background: rgba(245, 101, 101, 0.1);
            color: #c53030;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .final-paragraph {
                padding: 2rem;
            }

            .exercise-section {
                padding: 2rem;
            }

            .exercise-title {
                font-size: 2rem;
            }

            .topics-grid {
                grid-template-columns: 1fr;
            }

            .reset-btn {
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="decorative-element decorative-1"></div>
  <div class="decorative-element decorative-2"></div>
  <div class="decorative-element decorative-3"></div>
  <main class="container">
   <header class="header">
    <h1 class="main-title" id="mainTitle">PEE Paragraph Plan: The Community's Control</h1>
    <p class="subtitle" id="subtitle">Chapter 5 Analysis - The Giver</p>
   </header>
   <div class="analysis-grid">
    <div class="analysis-card">
     <div class="card-header">
      <div class="card-icon point-icon">
       P
      </div>
      <h2 class="card-title" id="pointTitle">Point - Main Idea</h2>
     </div>
     <div class="card-content">
      <p><strong>What is the main argument about the community's goal based on this event?</strong></p>
      <p>The community's primary goal is to control all deep personal emotions and human connections.</p>
     </div>
    </div>
    <div class="analysis-card">
     <div class="card-header">
      <div class="card-icon evidence-icon">
       E
      </div>
      <h2 class="card-title" id="evidenceTitle">Evidence - Text Clue</h2>
     </div>
     <div class="card-content">
      <p><strong>What is the exact, best quote from the text that proves your point?</strong></p>
      <div class="quote">
       His mother gave him a pill and told him to take one every morning. 'It will stop the Stirrings,' she explained, in a voice that was pleasant and without emotional depth.
      </div>
     </div>
    </div>
    <div class="analysis-card">
     <div class="card-header">
      <div class="card-icon explain-icon">
       E
      </div>
      <h2 class="card-title" id="explainTitle">Explain - Your Analysis</h2>
     </div>
     <div class="card-content">
      <p><strong>How does the quote prove your main argument? What does it make you infer?</strong></p>
      <p>This evidence shows that the community sees natural human feelings, like attraction, as a problem that must be eliminated. By making everyone take the pill, they prevent deep emotions like love or desire, ensuring all citizens remain calm, predictable, and fully compliant with the rules of the society.</p>
     </div>
    </div>
   </div>
   <div class="final-paragraph">
    <h2 class="final-title" id="finalTitle">Final PEE Paragraph</h2>
    <div class="final-content">
     The community's primary goal is to eliminate all deep, messy personal emotions and human connections. This control is made clear when Jonas's mother insists he take a daily pill, telling him, "His mother gave him a pill and told him to take one every morning. 'It will stop the Stirrings,' she explained, in a voice that was pleasant and without emotional depth." This policy proves that the community views natural feelings like attraction and love as a problem that must be medicated away. By ensuring every citizen takes the pill, the leaders guarantee that people remain emotionally calm and compliant, sacrificing the joy of genuine feeling for the sake of absolute social order.
    </div>
   </div>
   <div class="exercise-section">
    <div class="exercise-header">
     <h2 class="exercise-title">Your Turn: Practice PEE Analysis</h2>
     <p class="exercise-subtitle">Choose one of the issues below from Chapters 1-6 and write your own PEE paragraph</p>
    </div>
    <div class="topics-grid">
     <div class="topic-card" onclick="selectTopic(0)">
      <div class="topic-number">
       1
      </div>
      <h3>The Assignment System</h3>
      <p>How does the community's method of assigning life roles limit individual choice and freedom?</p>
     </div>
     <div class="topic-card" onclick="selectTopic(1)">
      <div class="topic-number">
       2
      </div>
      <h3>Family Units</h3>
      <p>What does the artificial creation of family units reveal about the community's control over relationships?</p>
     </div>
     <div class="topic-card" onclick="selectTopic(2)">
      <div class="topic-number">
       3
      </div>
      <h3>Precision of Language</h3>
      <p>How does the community's language rules (precision of language) limit people's ability to express themselves?</p>
     </div>
     <div class="topic-card" onclick="selectTopic(3)">
      <div class="topic-number">
       4
      </div>
      <h3>The Release System</h3>
      <p>What does the community's casual attitude toward "release" suggest about their values regarding life?</p>
     </div>
    </div>
    <div class="selected-topic" id="selectedTopic" style="display: none;">
     <h3 id="selectedTopicTitle"></h3>
     <p id="selectedTopicQuestion"></p>
     <div class="writing-exercise">
      <div class="pee-step"><label for="pointInput"><strong>P - Point (Main Idea):</strong></label> <textarea id="pointInput" placeholder="Write your main argument about this issue..."></textarea>
      </div>
      <div class="pee-step"><label><strong>E - Evidence (Choose the Best Quote):</strong></label>
       <p style="margin-bottom: 1rem; color: #4a5568; font-style: italic;">Select the quote that best supports your point from the options below:</p>
       <div class="quote-options" id="quoteOptions"><!-- Quote options will be populated here -->
       </div><input type="hidden" id="evidenceInput">
      </div>
      <div class="pee-step"><label for="explainInput"><strong>E - Explain (Your Analysis):</strong></label> <textarea id="explainInput" placeholder="Explain how your quote proves your main point..."></textarea>
      </div><button class="generate-btn" onclick="generateParagraph()">Generate My PEE Paragraph</button>
     </div>
     <div class="generated-paragraph" id="generatedParagraph" style="display: none;">
      <h4>Your Complete PEE Paragraph:</h4>
      <div class="paragraph-output" id="paragraphOutput"></div>
      <div class="ai-feedback-section">
       <div class="ai-feedback" id="aiFeedback">
        <h4>üìù AI Writing Coach Feedback</h4>
        <div class="feedback-content" id="feedbackContent"></div>
       </div>
      </div><button class="reset-btn" onclick="resetExercise()">Try Another Topic</button>
     </div>
    </div>
   </div>
  </main>
  <script>
        const defaultConfig = {
            main_title: "PEE Paragraph Plan: The Community's Control",
            subtitle: "Chapter 5 Analysis - The Giver",
            point_title: "Point - Main Idea",
            evidence_title: "Evidence - Text Clue",
            explain_title: "Explain - Your Analysis",
            final_title: "Final PEE Paragraph",
            background_color: "#667eea",
            surface_color: "#ffffff",
            text_color: "#2d3748",
            primary_action_color: "#764ba2",
            secondary_action_color: "#4a5568",
            font_family: "Georgia",
            font_size: 16
        };

        let config = { ...defaultConfig };

        async function onConfigChange(newConfig) {
            config = { ...config, ...newConfig };
            
            // Update text content
            document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
            document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
            document.getElementById('pointTitle').textContent = config.point_title || defaultConfig.point_title;
            document.getElementById('evidenceTitle').textContent = config.evidence_title || defaultConfig.evidence_title;
            document.getElementById('explainTitle').textContent = config.explain_title || defaultConfig.explain_title;
            document.getElementById('finalTitle').textContent = config.final_title || defaultConfig.final_title;

            // Update colors
            const backgroundColor = config.background_color || defaultConfig.background_color;
            const surfaceColor = config.surface_color || defaultConfig.surface_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

            document.body.style.background = `linear-gradient(135deg, ${backgroundColor} 0%, ${primaryColor} 100%)`;
            document.body.style.color = textColor;

            // Update surface colors
            const surfaces = document.querySelectorAll('.header, .analysis-card');
            surfaces.forEach(surface => {
                surface.style.background = `rgba(${hexToRgb(surfaceColor)}, 0.95)`;
            });

            // Update font
            const customFont = config.font_family || defaultConfig.font_family;
            const fontSize = config.font_size || defaultConfig.font_size;
            const fontStack = `${customFont}, serif`;
            
            document.body.style.fontFamily = fontStack;
            document.body.style.fontSize = `${fontSize}px`;
            
            // Scale other text elements proportionally
            document.querySelector('.main-title').style.fontSize = `${fontSize * 3}px`;
            document.querySelector('.subtitle').style.fontSize = `${fontSize * 1.25}px`;
            document.querySelectorAll('.card-title').forEach(el => {
                el.style.fontSize = `${fontSize * 1.5}px`;
            });
            document.querySelectorAll('.card-content').forEach(el => {
                el.style.fontSize = `${fontSize * 1.1}px`;
            });
            document.querySelector('.final-title').style.fontSize = `${fontSize * 2}px`;
            document.querySelector('.final-content').style.fontSize = `${fontSize * 1.2}px`;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? 
                `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : 
                '255, 255, 255';
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.surface_color || defaultConfig.surface_color,
                        set: (value) => {
                            config.surface_color = value;
                            window.elementSdk.setConfig({ surface_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => config.primary_action_color || defaultConfig.primary_action_color,
                        set: (value) => {
                            config.primary_action_color = value;
                            window.elementSdk.setConfig({ primary_action_color: value });
                        }
                    },
                    {
                        get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                        set: (value) => {
                            config.secondary_action_color = value;
                            window.elementSdk.setConfig({ secondary_action_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || defaultConfig.font_family,
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || defaultConfig.font_size,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["main_title", config.main_title || defaultConfig.main_title],
                ["subtitle", config.subtitle || defaultConfig.subtitle],
                ["point_title", config.point_title || defaultConfig.point_title],
                ["evidence_title", config.evidence_title || defaultConfig.evidence_title],
                ["explain_title", config.explain_title || defaultConfig.explain_title],
                ["final_title", config.final_title || defaultConfig.final_title]
            ]);
        }

        // Exercise functionality
        const topics = [
            {
                title: "The Assignment System",
                question: "How does the community's method of assigning life roles limit individual choice and freedom?",
                quotes: [
                    {
                        text: "The Chief Elder explained that Jonas had been selected, not assigned, to be the new Receiver of Memory.",
                        source: "Chapter 8",
                        correct: true,
                        feedback: "Perfect! This quote shows how the community controls life roles - even Jonas's 'selection' is really just another form of assignment by the authorities."
                    },
                    {
                        text: "Jonas felt the Stirrings again and knew he would have to report them to his parents.",
                        source: "Chapter 5",
                        correct: false,
                        feedback: "This quote is about emotional control, not job assignments. Look for quotes about how people get their life roles."
                    },
                    {
                        text: "The family unit shared their feelings from the day during the evening ritual.",
                        source: "Chapter 1",
                        correct: false,
                        feedback: "This is about family rituals, not career assignments. Focus on quotes about how the community decides people's jobs."
                    },
                    {
                        text: "Precision of language was very important in the community.",
                        source: "Chapter 3",
                        correct: false,
                        feedback: "This quote is about language rules, not job assignments. Look for evidence about how careers are chosen."
                    },
                    {
                        text: "Jonas's father worked at the Nurturing Center and cared for newchildren.",
                        source: "Chapter 2",
                        correct: false,
                        feedback: "This describes someone's job but doesn't show how assignments limit choice. Look for quotes about the assignment process itself."
                    },
                    {
                        text: "The community celebrated when elderly citizens were released to Elsewhere.",
                        source: "Chapter 4",
                        correct: false,
                        feedback: "This quote is about release ceremonies, not job assignments. Find evidence about how careers are assigned."
                    }
                ]
            },
            {
                title: "Family Units", 
                question: "What does the artificial creation of family units reveal about the community's control over relationships?",
                quotes: [
                    {
                        text: "Jonas's parents had applied for a child and been given Lily after waiting two years.",
                        source: "Chapter 1",
                        correct: true,
                        feedback: "Excellent choice! This shows how the community controls family formation - parents must apply and wait for permission to have children."
                    },
                    {
                        text: "The pills prevented the Stirrings and kept citizens from feeling attraction.",
                        source: "Chapter 5",
                        correct: false,
                        feedback: "This is about emotional control, not family structure. Look for quotes about how families are formed."
                    },
                    {
                        text: "Jonas was selected to be the new Receiver of Memory at the Ceremony of Twelve.",
                        source: "Chapter 8",
                        correct: false,
                        feedback: "This quote is about job assignments, not family relationships. Focus on how families are created."
                    },
                    {
                        text: "Citizens were required to use precise language when speaking to others.",
                        source: "Chapter 3",
                        correct: false,
                        feedback: "This is about language rules, not family formation. Look for evidence about how family units are established."
                    },
                    {
                        text: "The community held a release ceremony when people became too old to contribute.",
                        source: "Chapter 4",
                        correct: false,
                        feedback: "This quote is about release, not family relationships. Find evidence about how families are formed or controlled."
                    },
                    {
                        text: "Jonas felt different from his friends but couldn't explain why.",
                        source: "Chapter 2",
                        correct: false,
                        feedback: "This is about Jonas's personal feelings, not family structure. Look for quotes about how the community creates families."
                    }
                ]
            },
            {
                title: "Precision of Language",
                question: "How does the community's language rules (precision of language) limit people's ability to express themselves?",
                quotes: [
                    {
                        text: "Jonas was chastised for saying he was 'starving' when he only meant he was hungry.",
                        source: "Chapter 3",
                        correct: true,
                        feedback: "Perfect! This shows how precision of language prevents people from using expressive or emotional language, limiting their ability to communicate feelings."
                    },
                    {
                        text: "Jonas's father brought home a newchild who was struggling to sleep through the night.",
                        source: "Chapter 2",
                        correct: false,
                        feedback: "This is about childcare, not language rules. Look for quotes about how people are corrected for their word choices."
                    },
                    {
                        text: "The community assigned jobs to twelve-year-olds based on their observed abilities.",
                        source: "Chapter 8",
                        correct: false,
                        feedback: "This quote is about job assignments, not language control. Focus on evidence about how speech is regulated."
                    },
                    {
                        text: "Citizens took pills each morning to prevent the Stirrings from occurring.",
                        source: "Chapter 5",
                        correct: false,
                        feedback: "This is about emotional control through medication, not language rules. Look for quotes about word choice corrections."
                    },
                    {
                        text: "The family unit discussed their feelings during the evening sharing ritual.",
                        source: "Chapter 1",
                        correct: false,
                        feedback: "This describes a family ritual but doesn't show language restrictions. Find evidence about precision of language rules."
                    },
                    {
                        text: "Jonas watched as his friend Asher received his assignment as Assistant Director of Recreation.",
                        source: "Chapter 8",
                        correct: false,
                        feedback: "This is about career assignments, not language control. Look for quotes showing how word choice is corrected or limited."
                    }
                ]
            },
            {
                title: "The Release System",
                question: "What does the community's casual attitude toward 'release' suggest about their values regarding life?",
                quotes: [
                    {
                        text: "Jonas's father explained that he would release the smaller of the newborn twins because the community couldn't have identical people.",
                        source: "Chapter 4",
                        correct: true,
                        feedback: "Excellent! This shows the community's casual, matter-of-fact attitude toward ending life, treating it as a simple administrative decision."
                    },
                    {
                        text: "Jonas felt the Stirrings and knew he would need to start taking the pills.",
                        source: "Chapter 5",
                        correct: false,
                        feedback: "This quote is about emotional control, not the release system. Look for evidence about how the community treats release."
                    },
                    {
                        text: "The Chief Elder announced that Jonas had been chosen for a special assignment.",
                        source: "Chapter 8",
                        correct: false,
                        feedback: "This is about Jonas's selection as Receiver, not about release. Focus on quotes about how release is discussed or treated."
                    },
                    {
                        text: "Jonas was corrected for using imprecise language when he said he was starving.",
                        source: "Chapter 3",
                        correct: false,
                        feedback: "This quote is about language rules, not release. Look for evidence about the community's attitude toward ending life."
                    },
                    {
                        text: "The family unit shared their daily experiences during the evening ritual.",
                        source: "Chapter 1",
                        correct: false,
                        feedback: "This is about family sharing time, not release. Find quotes that show how casually the community treats release."
                    },
                    {
                        text: "Jonas's parents had applied for children and were approved by the community.",
                        source: "Chapter 2",
                        correct: false,
                        feedback: "This quote is about family formation, not release. Look for evidence about how the community discusses or handles release."
                    }
                ]
            }
        ];

        let selectedQuoteIndex = -1;
        let currentTopicIndex = -1;

        function selectTopic(index) {
            currentTopicIndex = index;
            const selectedTopic = document.getElementById('selectedTopic');
            const selectedTopicTitle = document.getElementById('selectedTopicTitle');
            const selectedTopicQuestion = document.getElementById('selectedTopicQuestion');
            
            selectedTopicTitle.textContent = topics[index].title;
            selectedTopicQuestion.textContent = topics[index].question;
            selectedTopic.style.display = 'block';
            
            // Reset form
            document.getElementById('pointInput').value = '';
            document.getElementById('evidenceInput').value = '';
            document.getElementById('explainInput').value = '';
            document.getElementById('generatedParagraph').style.display = 'none';
            selectedQuoteIndex = -1;
            
            // Populate quote options
            populateQuoteOptions(index);
            
            // Scroll to the selected topic
            selectedTopic.scrollIntoView({ behavior: 'smooth' });
        }

        function populateQuoteOptions(topicIndex) {
            const quoteOptions = document.getElementById('quoteOptions');
            const quotes = topics[topicIndex].quotes;
            
            // Shuffle quotes to randomize order
            const shuffledQuotes = [...quotes].sort(() => Math.random() - 0.5);
            
            quoteOptions.innerHTML = '';
            
            shuffledQuotes.forEach((quote, index) => {
                const quoteDiv = document.createElement('div');
                quoteDiv.className = 'quote-option';
                quoteDiv.onclick = () => selectQuote(quotes.indexOf(quote), quoteDiv);
                
                quoteDiv.innerHTML = `
                    <div class="quote-text">"${quote.text}"</div>
                    <div class="quote-source">- ${quote.source}</div>
                    <div class="quote-feedback ${quote.correct ? 'correct' : 'incorrect'}">
                        ${quote.feedback}
                    </div>
                `;
                
                quoteOptions.appendChild(quoteDiv);
            });
        }

        function selectQuote(quoteIndex, element) {
            // Remove previous selections
            document.querySelectorAll('.quote-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
                option.querySelector('.quote-feedback').style.display = 'none';
            });
            
            // Mark this quote as selected
            element.classList.add('selected');
            selectedQuoteIndex = quoteIndex;
            
            const quote = topics[currentTopicIndex].quotes[quoteIndex];
            
            // Show feedback after a brief delay
            setTimeout(() => {
                element.classList.add(quote.correct ? 'correct' : 'incorrect');
                element.querySelector('.quote-feedback').style.display = 'block';
                
                // Set the evidence input value
                document.getElementById('evidenceInput').value = quote.text;
                
                // Show encouraging message for correct choice
                if (quote.correct) {
                    showToast('Great choice! That\'s the perfect quote for your argument.');
                }
            }, 300);
        }

        function generateParagraph() {
            const point = document.getElementById('pointInput').value.trim();
            const evidence = document.getElementById('evidenceInput').value.trim();
            const explain = document.getElementById('explainInput').value.trim();
            
            if (!point) {
                showToast('Please write your main point first.');
                return;
            }
            
            if (selectedQuoteIndex === -1) {
                showToast('Please select a quote from the options provided.');
                return;
            }
            
            if (!explain) {
                showToast('Please write your explanation of how the quote supports your point.');
                return;
            }
            
            const paragraph = `${point} "${evidence}" ${explain}`;
            
            document.getElementById('paragraphOutput').textContent = paragraph;
            document.getElementById('generatedParagraph').style.display = 'block';
            
            // Automatically generate AI feedback
            generateAIFeedback();
            
            // Scroll to the generated paragraph
            document.getElementById('generatedParagraph').scrollIntoView({ behavior: 'smooth' });
        }

        function resetExercise() {
            document.getElementById('selectedTopic').style.display = 'none';
            document.getElementById('pointInput').value = '';
            document.getElementById('evidenceInput').value = '';
            document.getElementById('explainInput').value = '';
            document.getElementById('generatedParagraph').style.display = 'none';
            
            // Scroll back to topics
            document.querySelector('.topics-grid').scrollIntoView({ behavior: 'smooth' });
        }

        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(45deg, #ff6b6b, #ee5a24);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
                z-index: 1000;
                font-size: 1rem;
                max-width: 300px;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 4 seconds
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 4000);
        }

        function generateAIFeedback() {
            const point = document.getElementById('pointInput').value.trim();
            const evidence = document.getElementById('evidenceInput').value.trim();
            const explain = document.getElementById('explainInput').value.trim();
            const selectedTopicTitle = document.getElementById('selectedTopicTitle').textContent;
            
            const feedbackContent = document.getElementById('feedbackContent');
            
            // Show loading state
            feedbackContent.innerHTML = `
                <div class="loading-feedback">
                    <div class="loading-spinner"></div>
                    AI is analyzing your PEE paragraph...
                </div>
            `;
            
            // Simulate AI analysis (in a real implementation, this would call an AI API)
            setTimeout(() => {
                const feedback = analyzeStudentWork(point, evidence, explain, selectedTopicTitle);
                displayFeedback(feedback);
            }, 2000);
        }

        function analyzeStudentWork(point, evidence, explain, topic) {
            // Simulated AI analysis based on common PEE paragraph criteria
            const feedback = [];
            
            // Analyze Point section
            let pointScore = 0;
            let pointFeedback = "";
            
            if (point.length < 20) {
                pointFeedback = "Your main point could be more detailed. Try to make a clearer, stronger argument about the community's control.";
                pointScore = 2;
            } else if (point.includes("community") && (point.includes("control") || point.includes("limit") || point.includes("restrict"))) {
                pointFeedback = "Excellent! Your point clearly identifies the community's control mechanisms and their impact.";
                pointScore = 5;
            } else if (point.includes("community")) {
                pointFeedback = "Good start! Your point mentions the community, but could be more specific about how they control people.";
                pointScore = 3;
            } else {
                pointFeedback = "Try to make your point more specific about the community's methods of control in The Giver.";
                pointScore = 2;
            }
            
            feedback.push({
                category: "Point Analysis",
                text: pointFeedback,
                score: pointScore
            });
            
            // Analyze Evidence section
            let evidenceScore = 0;
            let evidenceFeedback = "";
            
            if (evidence.includes('"') || evidence.includes("'")) {
                if (evidence.length > 30) {
                    evidenceFeedback = "Great job including a direct quote! Your evidence is specific and supports your argument well.";
                    evidenceScore = 5;
                } else {
                    evidenceFeedback = "Good use of quotes, but try to include more context or a longer quote for stronger evidence.";
                    evidenceScore = 4;
                }
            } else if (evidence.length > 20) {
                evidenceFeedback = "You have good details, but remember to include direct quotes from the text for stronger evidence.";
                evidenceScore = 3;
            } else {
                evidenceFeedback = "Your evidence needs more detail. Include specific quotes from the book to support your point.";
                evidenceScore = 2;
            }
            
            feedback.push({
                category: "Evidence Quality",
                text: evidenceFeedback,
                score: evidenceScore
            });
            
            // Analyze Explanation section
            let explainScore = 0;
            let explainFeedback = "";
            
            if (explain.includes("shows") || explain.includes("proves") || explain.includes("demonstrates")) {
                if (explain.length > 50) {
                    explainFeedback = "Excellent analysis! You clearly explain how your evidence proves your point and show deep understanding.";
                    explainScore = 5;
                } else {
                    explainFeedback = "Good connection between evidence and point, but try to expand your analysis with more detail.";
                    explainScore = 4;
                }
            } else if (explain.length > 30) {
                explainFeedback = "Your explanation has good ideas, but try to more clearly connect your evidence to your main point.";
                explainScore = 3;
            } else {
                explainFeedback = "Your explanation needs more development. Explain how your quote proves your main argument.";
                explainScore = 2;
            }
            
            feedback.push({
                category: "Explanation Depth",
                text: explainFeedback,
                score: explainScore
            });
            
            // Overall feedback
            const avgScore = Math.round((pointScore + evidenceScore + explainScore) / 3);
            let overallFeedback = "";
            
            if (avgScore >= 4) {
                overallFeedback = "Outstanding work! Your PEE paragraph demonstrates strong analytical thinking and clear understanding of The Giver's themes.";
            } else if (avgScore >= 3) {
                overallFeedback = "Good effort! You're on the right track. Focus on adding more specific details and stronger connections between your ideas.";
            } else {
                overallFeedback = "Keep working on it! Remember: Point (clear argument), Evidence (specific quotes), Explain (connect evidence to point).";
            }
            
            feedback.push({
                category: "Overall Assessment",
                text: overallFeedback,
                score: avgScore
            });
            
            return feedback;
        }

        function displayFeedback(feedback) {
            const feedbackContent = document.getElementById('feedbackContent');
            
            let html = '';
            feedback.forEach(item => {
                const scoreColor = item.score >= 4 ? '#48bb78' : item.score >= 3 ? '#ed8936' : '#f56565';
                html += `
                    <div class="feedback-item">
                        <div class="feedback-category">
                            ${item.category}
                            <span class="feedback-score" style="background: ${scoreColor};">${item.score}/5</span>
                        </div>
                        <div class="feedback-text">${item.text}</div>
                    </div>
                `;
            });
            
            feedbackContent.innerHTML = html;
        }

        // Initialize the SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99487b64125ee34c',t:'MTc2MTQ2NjI3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
